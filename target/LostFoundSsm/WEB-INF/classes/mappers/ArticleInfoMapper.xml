<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--城市表数据库操作-->
<mapper namespace="dao.ArticleInfoDao">
    <resultMap id="ArticleInfoResultMap" type="entity.ArticleInfo">
        <id column="id" property="id"/>
        <result column="type_id" property="typeId"/>
        <result column="phone" property="phone"/>
        <result column="user_id" property="userId"/>
        <result column="find_time" property="findTime"/>
        <result column="address_content" property="addressContent"/>
        <result column="description" property="description"/>
        <result column="status" property="status"/>
        <result column="imgStr" property="imgStr"/>
        <result column="record_status" property="recordStatus"/>
        <result column="helper_id" property="helperId"/>
        <result column="back_time" property="backTime"/>
        <result column="create_time" property="createTime"/>
        <result column="last_edit_time" property="lastEditTime"/>
        <association property="personInfo" column="user_id"
                     javaType="entity.PersonInfo">
            <id column="user_id" property="userId" />
            <result column="nick_name" property="nickname" />
            <result column="profile_img" property="profileImg" />
            <result column="gender" property="gender" />
            <result column="email" property="email" />
            <result column="user_type" property="userType" />
            <result column="create_time" property="createTime" />
            <result column="last_edit_time" property="lastEditTime" />
            <result column="help_times" property="helpTimes" />
        </association>
    </resultMap>

    <select id="queryArticleInfo" resultMap="ArticleInfoResultMap">
        SELECT a.*,p.nick_name,p.profile_img,p.gender,p.help_times
        FROM lf_article_info a
        LEFT JOIN
        lf_person_info p ON
        a.user_id = p.user_id
        <where>
            <if test="userId!=-1">
                and a.user_id = #{userId}
            </if>
            <if test="typeId!=-1">
                and a.type_id = #{typeId}
            </if>

            <if test="status!=-1">
                and a.status = #{status}
            </if>
            <if test="recordStatus!=-1">
                and a.record_status = #{recordStatus}
            </if>
            <if test="addressContent!=null">
                and a.address_content LIKE "%"#{addressContent}"%"
            </if>
            <if test="description!=null">
                and a.description LIKE  "%"#{description}"%"
            </if>
        </where>
        ORDER BY create_time DESC
        LIMIT #{start} ,#{pageSize}
    </select>
    <select id="searchArInfo" resultMap="ArticleInfoResultMap">
        SELECT a.*,p.nick_name,p.profile_img,p.gender,p.help_times
        FROM lf_article_info a
        LEFT JOIN
        lf_person_info p ON
        a.user_id = p.user_id

        <where>
            and a.status = a.record_status
            <if test="addressContent!=null">
                and a.address_content LIKE "%"#{addressContent}"%"
            </if>
            <if test="description!=null">
                and a.description LIKE  "%"#{description}"%"
            </if>
        </where>
        ORDER BY create_time DESC
        LIMIT #{start} ,#{pageSize}
    </select>
    <insert id="insert" parameterType="entity.ArticleInfo">
        INSERT INTO
        lf_article_info(id,type_id,user_id,phone,find_time,address_content
                        ,description,status,imgStr,record_status,create_time)
        VALUES
        (#{id},#{typeId},#{userId},#{phone},#{findTime},#{addressContent}
        ,#{description},#{status},#{imgStr},#{recordStatus},#{createTime})
    </insert>

    <!--    <update id="update">-->

    <!--    </update>-->
</mapper>